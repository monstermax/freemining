
Miner run

<hr />


<%
//const runningMiners = Object.entries(allMiners).filter((entry) => entry[1].running).map(entry => entry[0]);
const installedMiners = Object.entries(allMiners).filter((entry) => entry[1].installed).map(entry => entry[0]);
const installableMiners = Object.entries(allMiners).filter((entry) => entry[1].installable).map(entry => entry[0]);
const runnableMiners = Object.entries(allMiners).filter((entry) => entry[1].runnable).map(entry => entry[0]);
const managedMiners = Object.entries(allMiners).filter((entry) => entry[1].managed).map(entry => entry[0]);
%>


<h3>Manage</h3>
<%- (() => {
    let html = '';

    if (minerStatus) {
        html += miner + ' is <span class="badge bg-success">running</span>';
        html += '&nbsp;&nbsp;&nbsp;&nbsp;';
        html += '&nbsp;&nbsp;&nbsp;&nbsp;';
        html += ' <a class="btn btn-danger btn-sm" onclick="stopMiner()" href="javascript:void(0)">Stop Miner</a>';
        html += '&nbsp;&nbsp;&nbsp;&nbsp;';
        html += ' <a class="btn btn-primary btn-sm" href="?action=log">Show logs</a>';
        html += ' <a class="btn btn-secondary btn-sm" href="?action=status">JSON Status</a>';

    } else {
        html += miner + ' is <span class="badge bg-danger">not running</span>';
        if (installedMiners.includes(miner) && runnableMiners.includes(miner)) {
            html += ' <a class="btn btn-primary btn-sm" onclick="startMiner()" href="javascript:void(0)">Start Miner</a>';
        }
    }

    return html;
})() %>


<hr />

<h3>Status</h3>
<% if (! rigInfos.status?.monitorStatus) { %>
    <div class="alert alert-warning">Warning: JSON status requires rig monitor to be started. Click here to <a href="/rig/monitor-run">start monitor</a></div>

<% } else if ( ! managedMiners.includes(miner) ) { %>
    <div class="alert alert-warning">Warning: this miner is not managed</div>

<% } else { %>
    <pre>
    <%- JSON.stringify(minerInfos, null, 4) %>
    </pre>
<% } %>


<script>
const minerName = '<%=miner%>';

function startMiner(minerAlias='') {
    const onStart = null;
    const onSuccess = () => window.location.reload();
    const onFail = null;
    startMinerModal(minerName, minerAlias, onStart, onSuccess, onFail);
}

function stopMiner(minerAlias='') {
    const onStart = null;
    const onSuccess = () => window.location.reload();
    const onFail = null;

    stopMinerAjax(minerName, minerAlias, onStart, onSuccess, onFail);
}
</script>


<%
const availableCoinsMiners = Object.keys(rigInfos.config.coinsMiners);
const availableCoinsWallets = Object.keys(rigInfos.config.coinsWallets);
const availableCoinsPools = Object.keys(rigInfos.config.coinsPools);

const availableCoinsAllTmp = Array.from(new Set( [
    ...availableCoinsMiners,
    ...availableCoinsWallets,
    ...availableCoinsPools,
] ));

const availableCoins = availableCoinsAllTmp.filter(coin => (
    true
    && availableCoinsMiners.includes(coin)
    && availableCoinsWallets.includes(coin)
    && availableCoinsPools.includes(coin)
));
%>

<script>

const miners = <%- JSON.stringify(rigInfos.config.miners, null, 0) %>;

const coinsMiners = <%- JSON.stringify(rigInfos.config.coinsMiners, null, 0) %>;
const coinsWallets = <%- JSON.stringify(rigInfos.config.coinsWallets, null, 0) %>;
const coinsPools = <%- JSON.stringify(rigInfos.config.coinsPools, null, 0) %>;

const availableCoins = <%- JSON.stringify(availableCoins, null, 0) %>;

</script>

